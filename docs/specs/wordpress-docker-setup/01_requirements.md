# 要件定義書: WordPress Docker環境構築

## ドキュメント情報
- **spec名**: wordpress-docker-setup
- **作成日**: 2026-02-17
- **最終更新日**: 2026-02-17
- **ステータス**: レビュー待ち
- **バージョン**: 1.2

---

## 1. 概要と目的

### 1.1 目的
Docker ComposeでWordPress開発環境を構築し、ローカル開発に適した設定を行う。チーム間で統一された開発環境を提供し、環境構築の手間を最小化する。

### 1.2 対象ユーザー
- WordPress開発者
- ローカル環境でWordPressのテーマ・プラグイン開発を行うエンジニア
- Docker基本知識を持つ開発者

### 1.3 期待される効果
- 環境構築時間の短縮（5分以内での起動を目標）
- チーム間での開発環境の統一
- データの永続化によるコンテナ再作成時のデータ保持
- 再現可能な開発環境の提供

---

## 2. 機能要件

### 2.1 WordPress環境

#### 2.1.1 WordPressバージョンの柔軟性
- **要件ID**: REQ-WP-001
- **内容**: WordPressのバージョンとWebサーバーを環境変数で切り替え可能にする
- **理由**: 異なるバージョンやWebサーバーでのテスト、互換性確認を容易にするため
- **優先度**: 必須
- **受け入れ基準**:
  - `.env`ファイルで以下を設定可能であること:
    - `WP_VERSION`: WordPressバージョン（例: latest, 6.4, 6.3）
    - `PHP_VERSION`: PHPバージョン（例: 8.1, 8.2, 8.3）
    - `WP_SERVER`: Webサーバー種類（apache または fpm）
  - イメージタグが`wordpress:${WP_VERSION}-php${PHP_VERSION}-${WP_SERVER}`形式で構成されること
  - デフォルト値として`latest-php8.2-apache`を使用すること
  - Apache使用時は`wordpress:php${PHP_VERSION}-apache`イメージを使用すること
  - Nginx使用時は`wordpress:php${PHP_VERSION}-fpm`と`nginx:alpine`の組み合わせを使用すること

#### 2.1.2 Webサーバー切り替え機能
- **要件ID**: REQ-WP-002
- **内容**: Apache/Nginxを環境変数で切り替え可能にする
- **理由**: 本番環境と同じWebサーバーでテストする必要性や、パフォーマンス比較のため
- **優先度**: 必須
- **受け入れ基準**:
  - `.env`ファイルで`WP_SERVER`変数（apache/fpm）を設定できること
  - Apache選択時: wordpress:apache イメージのみで動作すること
  - Nginx選択時: wordpress:fpm イメージとnginxコンテナで動作すること
  - 切り替え時もデータ（wp-content）が保持されること
  - docker-compose.ymlで条件分岐なしに両対応できる設計であること

#### 2.1.3 ポート設定
- **要件ID**: REQ-WP-003
- **内容**: WordPressはホストの8080ポートでアクセス可能にする
- **理由**: 一般的な開発用ポート（80）との競合を避けるため
- **優先度**: 必須
- **受け入れ基準**:
  - `http://localhost:8080`でWordPressにアクセスできること
  - 他のローカルサーバーとポート競合しないこと

### 2.2 データベース環境

#### 2.2.1 データベース種類とバージョンの柔軟性
- **要件ID**: REQ-DB-001
- **内容**: データベース種類（MySQL/MariaDB）とバージョンを環境変数で切り替え可能にする
- **理由**: 本番環境との整合性確保、互換性テスト、パフォーマンス比較のため
- **優先度**: 必須
- **受け入れ基準**:
  - `.env`ファイルで以下を設定可能であること:
    - `DB_TYPE`: データベース種類（mysql または mariadb）
    - `DB_VERSION`: バージョン番号（例: MySQL → 8.0, 8.4 / MariaDB → 10.11, 11.4）
  - イメージが`${DB_TYPE}:${DB_VERSION}`形式で構成されること
  - デフォルト値としてMySQL 8.0（`mysql:8.0`）を使用すること
  - MySQL/MariaDBどちらを選択してもWordPressから正常に接続できること
  - データベース切り替え時も環境変数（ユーザー名、パスワード等）が共通して使えること

#### 2.2.2 データベース認証情報
- **要件ID**: REQ-DB-002
- **内容**: データベース名、ユーザー名、パスワード、ルートパスワードを環境変数で設定可能にする
- **理由**: セキュリティとカスタマイズ性の向上
- **優先度**: 必須
- **受け入れ基準**:
  - `.env`ファイルで以下の値を設定できること:
    - `MYSQL_DATABASE`: データベース名（デフォルト: wordpress）
    - `MYSQL_USER`: データベースユーザー名（デフォルト: wordpress）
    - `MYSQL_PASSWORD`: ユーザーパスワード（デフォルト: wordpress）
    - `MYSQL_ROOT_PASSWORD`: rootパスワード（デフォルト: rootpassword）

#### 2.2.3 データベースポート
- **要件ID**: REQ-DB-003
- **内容**: データベースポート（3306）はホストに公開しない
- **理由**: セキュリティリスクの低減と、ローカルMySQLとの競合回避
- **優先度**: 必須
- **受け入れ基準**:
  - docker-compose.ymlでMySQLコンテナのポートマッピングを設定していないこと
  - WordPressコンテナからはDockerネットワーク経由で接続できること

### 2.3 データ永続化

#### 2.3.1 WordPressファイルの永続化
- **要件ID**: REQ-VOL-001
- **内容**: `wp-content`ディレクトリをホストにマウントする
- **理由**: テーマ、プラグイン、アップロードファイルの永続化と開発効率向上
- **優先度**: 必須
- **受け入れ基準**:
  - `./wordpress/wp-content`をコンテナの`/var/www/html/wp-content`にマウントしていること
  - コンテナ再作成後もテーマやプラグインが保持されること
  - ホスト側でファイル編集が即座にコンテナに反映されること

#### 2.3.2 データベースデータの永続化
- **要件ID**: REQ-VOL-002
- **内容**: MySQLデータを名前付きボリュームで永続化する
- **理由**: データベースデータの保持とコンテナ再作成時の安全性
- **優先度**: 必須
- **受け入れ基準**:
  - Docker名前付きボリューム（`db_data`）を使用していること
  - コンテナ再作成後もデータベース内容が保持されること
  - `docker-compose down -v`を実行しない限りデータが削除されないこと

### 2.4 開発支援機能

#### 2.4.1 デバッグモード有効化
- **要件ID**: REQ-DEV-001
- **内容**: WordPressのデバッグモードを有効にする
- **理由**: 開発時のエラー検出と問題解決の効率化
- **優先度**: 必須
- **受け入れ基準**:
  - 以下の環境変数が設定されていること:
    - `WORDPRESS_DEBUG`: 1（有効）
    - `WORDPRESS_DEBUG_LOG`: 1（ログ出力有効）
    - `WORDPRESS_DEBUG_DISPLAY`: 1（画面表示有効）

#### 2.4.2 エラーログ出力
- **要件ID**: REQ-DEV-002
- **内容**: PHPエラーログを`wp-content/debug.log`に出力する
- **理由**: エラーの追跡とデバッグ作業の効率化
- **優先度**: 必須
- **受け入れ基準**:
  - `wp-content/debug.log`にエラーが記録されること
  - ホスト側からログファイルを確認できること

#### 2.4.3 自動起動設定
- **要件ID**: REQ-DEV-003
- **内容**: コンテナの再起動ポリシーを設定する
- **理由**: 開発中の意図しない停止からの自動復旧
- **優先度**: 推奨
- **受け入れ基準**:
  - `restart: unless-stopped`が設定されていること
  - Dockerデーモン再起動時にコンテナが自動起動すること

### 2.5 データベース管理ツール

#### 2.5.1 phpMyAdmin統合
- **要件ID**: REQ-PMA-001
- **内容**: phpMyAdminをオプションで利用可能にする
- **理由**: データベースの視覚的な管理とデバッグ作業の効率化
- **優先度**: 推奨
- **受け入れ基準**:
  - `.env`ファイルで`PHPMYADMIN_ENABLED`変数（true/false）を設定できること
  - `true`に設定した場合のみphpMyAdminコンテナが起動すること
  - WordPressと同じデータベースに自動接続できること
  - データベース種類（MySQL/MariaDB）切り替えに対応していること

#### 2.5.2 phpMyAdminバージョン管理
- **要件ID**: REQ-PMA-002
- **内容**: phpMyAdminのバージョンを環境変数で指定可能にする
- **理由**: 最新機能の利用や特定バージョンでのテストのため
- **優先度**: 推奨
- **受け入れ基準**:
  - `.env`ファイルで`PHPMYADMIN_VERSION`を設定可能であること
  - イメージが`phpmyadmin:${PHPMYADMIN_VERSION}`形式で構成されること
  - デフォルト値として`latest`を使用すること
  - バージョン変更時も設定（データベース接続情報）が保持されること

#### 2.5.3 phpMyAdminポート設定
- **要件ID**: REQ-PMA-003
- **内容**: phpMyAdminのアクセスポートを環境変数で設定可能にする
- **理由**: ポート競合の回避と柔軟な環境構築
- **優先度**: 推奨
- **受け入れ基準**:
  - `.env`ファイルで`PHPMYADMIN_PORT`を設定可能であること
  - デフォルト値として8081を使用すること
  - `http://localhost:${PHPMYADMIN_PORT}`でアクセスできること
  - WordPressのポート（8080）と競合しないこと

### 2.6 環境設定管理

#### 2.6.1 環境変数ファイル
- **要件ID**: REQ-ENV-001
- **内容**: `.env`ファイルで環境変数を管理し、`.env.example`をサンプルとして提供する
- **理由**: 機密情報の保護とチーム間での設定共有、柔軟な構成変更
- **優先度**: 必須
- **受け入れ基準**:
  - `.env.example`ファイルが存在し、以下の環境変数が記載されていること:
    - WordPress関連: `WP_VERSION`, `PHP_VERSION`, `WP_SERVER`
    - データベース関連: `DB_TYPE`, `DB_VERSION`
    - 認証情報: `MYSQL_DATABASE`, `MYSQL_USER`, `MYSQL_PASSWORD`, `MYSQL_ROOT_PASSWORD`
    - ポート設定: `WP_PORT`（デフォルト8080）
    - phpMyAdmin関連: `PHPMYADMIN_ENABLED`, `PHPMYADMIN_VERSION`, `PHPMYADMIN_PORT`
  - 各変数に説明コメントが記載されていること
  - `.env`ファイルが`.gitignore`に追加されていること
  - `.env.example`から`.env`をコピーするだけで起動できること

#### 2.6.2 環境変数による動的構成
- **要件ID**: REQ-ENV-002
- **内容**: docker-compose.ymlで環境変数を参照し、動的にイメージとサービスを構成する
- **理由**: 設定ファイル（.env）の変更のみで構成を切り替えるため
- **優先度**: 必須
- **受け入れ基準**:
  - docker-compose.ymlでハードコードされた値がないこと（すべて環境変数参照）
  - `.env`ファイルの値を変更して`docker-compose up`するだけで構成が切り替わること
  - 環境変数が未設定の場合もデフォルト値で動作すること

---

## 3. 非機能要件

### 3.1 パフォーマンス

#### 3.1.1 起動時間
- **要件ID**: NFR-PERF-001
- **内容**: 初回起動時5分以内、2回目以降30秒以内にアクセス可能になること
- **優先度**: 推奨
- **測定方法**: `docker-compose up -d`実行から`http://localhost:8080`にアクセス可能になるまでの時間

#### 3.1.2 メモリ設定
- **要件ID**: NFR-PERF-002
- **内容**: PHPメモリ制限を256MB以上に設定する
- **理由**: WordPress標準機能とプラグイン動作の安定性確保
- **優先度**: 推奨
- **受け入れ基準**:
  - WordPress管理画面の「サイトヘルス」でメモリ不足の警告が出ないこと

#### 3.1.3 アップロードサイズ制限
- **要件ID**: NFR-PERF-003
- **内容**: ファイルアップロード上限を64MB以上に設定する
- **理由**: 開発時の画像・メディアファイルアップロードの利便性
- **優先度**: 推奨
- **受け入れ基準**:
  - 管理画面のメディアアップロードで64MBまでのファイルをアップロードできること

### 3.2 セキュリティ

#### 3.2.1 機密情報の保護
- **要件ID**: NFR-SEC-001
- **内容**: パスワードやAPIキーを`.env`ファイルで管理し、Gitにコミットしない
- **優先度**: 必須
- **受け入れ基準**:
  - `.env`が`.gitignore`に含まれていること
  - docker-compose.ymlに平文のパスワードが記載されていないこと

#### 3.2.2 デフォルトパスワードの変更推奨
- **要件ID**: NFR-SEC-002
- **内容**: `.env.example`にデフォルトパスワードの変更を促す注記を記載する
- **優先度**: 推奨
- **受け入れ基準**:
  - `.env.example`にパスワード変更を促すコメントが記載されていること

#### 3.2.3 ローカル環境限定
- **要件ID**: NFR-SEC-003
- **内容**: 本番環境での使用を想定しない設定であることをREADMEに明記する
- **優先度**: 必須
- **受け入れ基準**:
  - READMEに「ローカル開発専用」との注記があること
  - デバッグモードが有効であることの注意書きがあること

### 3.3 可用性

#### 3.3.1 コンテナ間依存関係
- **要件ID**: NFR-AVAIL-001
- **内容**: WordPressコンテナがデータベースコンテナの起動完了を待機する
- **優先度**: 必須
- **受け入れ基準**:
  - `depends_on`でデータベースへの依存関係が定義されていること
  - WordPressがデータベース接続エラーで起動失敗しないこと

#### 3.3.2 ヘルスチェック
- **要件ID**: NFR-AVAIL-002
- **内容**: データベースコンテナのヘルスチェックを設定する
- **優先度**: 推奨
- **受け入れ基準**:
  - MySQLコンテナに`healthcheck`が設定されていること
  - `docker-compose ps`でヘルスステータスを確認できること

### 3.4 保守性

#### 3.4.1 ドキュメント整備
- **要件ID**: NFR-MAINT-001
- **内容**: README.mdに起動・停止・トラブルシューティング手順を記載する
- **優先度**: 必須
- **受け入れ基準**:
  - README.mdに以下が記載されていること:
    - 前提条件（Dockerのインストール等）
    - セットアップ手順
    - 起動・停止コマンド
    - アクセスURL
    - よくあるトラブルと解決方法

#### 3.4.2 コメント記載
- **要件ID**: NFR-MAINT-002
- **内容**: docker-compose.ymlに各設定項目の説明コメントを記載する
- **優先度**: 推奨
- **受け入れ基準**:
  - 主要な設定項目に日本語コメントが記載されていること

---

## 4. 制約条件

### 4.1 技術的制約
- **制約ID**: CON-TECH-001
- **内容**: Dockerおよびドッカーコンポーズがインストール済みであること
- **影響**: 環境構築前の前提条件

- **制約ID**: CON-TECH-002
- **内容**: ホストの8080ポートが使用可能であること
- **影響**: 既存サービスとの競合がある場合はポート変更が必要

- **制約ID**: CON-TECH-003
- **内容**: macOS、Windows、Linuxで動作すること
- **影響**: プラットフォーム固有の設定を避ける必要がある

### 4.2 ビジネス制約
- **制約ID**: CON-BIZ-001
- **内容**: ローカル開発環境のみを対象とし、本番環境では使用しない
- **影響**: セキュリティ設定は開発に最適化し、本番レベルの強化は行わない

### 4.3 運用制約
- **制約ID**: CON-OPS-001
- **内容**: コンテナ削除時にデータを保持するため、`docker-compose down -v`の実行には注意が必要
- **影響**: データ削除前に確認フローが必要

---

## 5. 受け入れ基準

### 5.1 機能面
- [ ] `docker-compose up -d`でWordPressとMySQLが起動する
- [ ] `http://localhost:8080`でWordPressにアクセスできる
- [ ] WordPress初期セットアップが完了できる
- [ ] テーマ・プラグインのインストールができる
- [ ] メディアファイルのアップロードができる
- [ ] コンテナ再作成後もデータが保持される
- [ ] デバッグモードが有効で、エラーが`wp-content/debug.log`に記録される
- [ ] `PHPMYADMIN_ENABLED=true`に設定するとphpMyAdminが起動する
- [ ] `http://localhost:8081`でphpMyAdminにアクセスできる
- [ ] phpMyAdminからデータベースに自動ログインできる
- [ ] `PHPMYADMIN_ENABLED=false`に設定するとphpMyAdminが起動しない

### 5.2 設定面
- [ ] `.env.example`ファイルが存在し、すべての必要な環境変数が記載されている
- [ ] `.env`ファイルが`.gitignore`に含まれている
- [ ] docker-compose.ymlに平文パスワードが含まれていない
- [ ] `.env`でWordPressバージョンを変更して再起動すると、そのバージョンで動作する
- [ ] `.env`でPHPバージョンを変更して再起動すると、そのバージョンで動作する
- [ ] `.env`でWebサーバー（Apache/Nginx）を切り替えて再起動すると、正常に動作する
- [ ] `.env`でデータベース種類（MySQL/MariaDB）を切り替えて再起動すると、正常に動作する
- [ ] `.env`でデータベースバージョンを変更して再起動すると、そのバージョンで動作する
- [ ] `.env`でphpMyAdminバージョンを変更して再起動すると、そのバージョンで動作する
- [ ] `.env`でphpMyAdminポートを変更して再起動すると、そのポートでアクセスできる
- [ ] すべての構成切り替え時にwp-contentのデータが保持される

### 5.3 ドキュメント面
- [ ] README.mdに起動手順が記載されている
- [ ] README.mdにアクセス方法が記載されている
- [ ] README.mdに停止・削除手順が記載されている
- [ ] README.mdにトラブルシューティングが記載されている

### 5.4 品質面
- [ ] 初回起動が5分以内に完了する
- [ ] 2回目以降の起動が30秒以内に完了する
- [ ] 64MBのファイルをアップロードできる
- [ ] `docker-compose down`と`docker-compose up -d`の繰り返しでデータが保持される

---

## 6. 除外事項

以下の項目は本要件の対象外とします。

### 6.1 本番環境対応
- SSL/HTTPS設定
- リバースプロキシ設定
- 本番環境用のセキュリティ強化
- パフォーマンスチューニング

### 6.2 開発ツール
- Xdebug等のデバッグツール（PHPデバッガー）
- WP-CLI等のコマンドラインツール
- Mailhog等のメール確認ツール

### 6.3 WordPress本体のカスタマイズ
- カスタムテーマの開発
- プラグインの開発
- WordPress設定のプリセット
- サンプルコンテンツの投入

### 6.4 CI/CDパイプライン
- 自動テスト環境
- デプロイメント設定
- GitHub Actions等のCI/CD設定

### 6.5 メール機能
- SMTPサーバー設定
- メール送信テスト環境

---

## 7. 参考情報

### 7.1 公式ドキュメント
- WordPress公式Dockerイメージ: https://hub.docker.com/_/wordpress
- MySQL公式Dockerイメージ: https://hub.docker.com/_/mysql
- MariaDB公式Dockerイメージ: https://hub.docker.com/_/mariadb
- phpMyAdmin公式Dockerイメージ: https://hub.docker.com/_/phpmyadmin
- Docker Compose公式ドキュメント: https://docs.docker.com/compose/

### 7.2 WordPress推奨環境
- PHP: 8.1以上
- MySQL: 8.0以上 または MariaDB 10.5以上
- メモリ: 256MB以上（推奨512MB）

---

## 8. 変更履歴

| バージョン | 日付 | 変更内容 | 変更者 |
|----------|------|---------|--------|
| 1.0 | 2026-02-17 | 初版作成 | Claude Code |
| 1.1 | 2026-02-17 | 環境変数による柔軟な構成切り替え機能を追加（WordPress/PHP/Webサーバー/DB種類/DBバージョンの切り替え対応） | Claude Code |
| 1.2 | 2026-02-17 | phpMyAdmin機能を追加（除外事項から機能要件に移動、バージョン・ポート設定、有効/無効切り替え対応） | Claude Code |

---

## 9. 承認

| 役割 | 氏名 | 承認日 | 署名 |
|-----|------|--------|------|
| 要件定義者 | Claude Code | 2026-02-17 | - |
| レビュアー | - | - | - |
| 承認者 | - | - | - |

---

## 10. 次フェーズへの引き継ぎ

### 10.1 設計フェーズで検討すべき項目
1. **docker-compose.ymlの詳細構造**
   - サービス定義の詳細（wordpress、db、nginx、phpmyadmin）
   - 環境変数によるイメージタグの動的構成方法
   - phpMyAdminの条件付き起動方法（profiles機能の活用等）
   - ネットワーク設計
   - ボリューム定義の詳細

2. **Nginx構成（fpm使用時）**
   - nginx.confの設計
   - FastCGI設定
   - WordPressとの連携方法
   - 静的ファイルの配信設定

3. **phpMyAdmin構成**
   - データベース接続の自動設定方法
   - MySQL/MariaDB両対応の設定
   - セキュリティ設定（ローカル環境専用）
   - 環境変数による有効/無効の制御方法

4. **ディレクトリ構成**
   - プロジェクトルートの構造
   - マウントポイントの配置
   - nginx設定ファイルの配置（nginx/nginx.conf等）

5. **環境変数設計**
   - `.env`と`.env.example`の具体的な内容
   - 変数名の命名規則
   - デフォルト値の設定
   - 各構成パターンでの推奨値
   - phpMyAdmin関連変数の詳細

6. **構成パターンの管理**
   - Apache + MySQL パターン
   - Apache + MariaDB パターン
   - Nginx + MySQL パターン
   - Nginx + MariaDB パターン
   - 各パターン + phpMyAdmin有効/無効
   - 各パターンでの動作確認方法

7. **エラーハンドリング**
   - 起動失敗時の対応
   - ポート競合時の対応
   - 不正な環境変数値の検証
   - phpMyAdmin接続エラー時の対応

8. **README構成**
   - セクション構成
   - 各構成パターンの説明
   - phpMyAdminの使用方法
   - 構成切り替え手順
   - トラブルシューティング項目

---

**このドキュメントに対するフィードバックをお願いいたします。**
